<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Olumide Oyalola">
<meta name="dcterms.date" content="2022-10-19">
<meta name="description" content="In this blog post, I would demonstrate how I used the osrm package in R to return the distance and travel time between a destination and different sources">

<title>Olumide Oyalola - Working with the OSRM API</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-listing/list.min.js"></script>
<script src="../../site_libs/quarto-listing/quarto-listing.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script>

  window.document.addEventListener("DOMContentLoaded", function (_event) {
    const listingTargetEl = window.document.querySelector('#listing-listing .list');
    if (!listingTargetEl) {
      // No listing discovered, do not attach.
      return; 
    }

    const options = {
      valueNames: [{ data: ['index'] },{ data: ['categories'] },{ data: ['listing-date-sort'] },{ data: ['listing-file-modified-sort'] }],
      
      searchColumns: [],
    };

    window['quarto-listings'] = window['quarto-listings'] || {};
    window['quarto-listings']['listing-listing'] = new List('listing-listing', options);

    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  });

  window.addEventListener('hashchange',() => {
    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  })
  </script>

<script src="../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../../site_libs/datatables-binding-0.26/datatables.js"></script>
<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../../site_libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../../site_libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="../../index.css">
<meta property="og:title" content="Olumide Oyalola - Working with the OSRM API">
<meta property="og:description" content="In this blog post, I would demonstrate how I used the osrm package in R to return the distance and travel time between a destination and different sources">
<meta property="og:site-name" content="Olumide Oyalola">
<meta name="twitter:title" content="Olumide Oyalola - Working with the OSRM API">
<meta name="twitter:description" content="In this blog post, I would demonstrate how I used the osrm package in R to return the distance and travel time between a destination and different sources">
<meta name="twitter:creator" content="@iamolumide">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Olumide Oyalola</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html">Blog</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../../blog.xml"><i class="bi bi-rss" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#introduction-to-osrm-r-package" id="toc-introduction-to-osrm-r-package" class="nav-link active" data-scroll-target="#introduction-to-osrm-r-package">Introduction to OSRM R package</a></li>
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link" data-scroll-target="#load-packages">Load Packages</a>
  <ul class="collapse">
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load Data</a></li>
  </ul></li>
  <li><a href="#data-munging" id="toc-data-munging" class="nav-link" data-scroll-target="#data-munging">Data Munging</a>
  <ul class="collapse">
  <li><a href="#determining-the-direction-of-the-truck" id="toc-determining-the-direction-of-the-truck" class="nav-link" data-scroll-target="#determining-the-direction-of-the-truck">Determining the direction of the truck</a></li>
  <li><a href="#estimating-the-arrival-time-and-distance" id="toc-estimating-the-arrival-time-and-distance" class="nav-link" data-scroll-target="#estimating-the-arrival-time-and-distance">Estimating the arrival time and distance</a></li>
  </ul></li>
  <li><a href="#data-join" id="toc-data-join" class="nav-link" data-scroll-target="#data-join">Data Join</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Working with the OSRM API</h1>
  <div class="quarto-categories">
    <div class="quarto-category">CODE</div>
    <div class="quarto-category">ANALYSIS</div>
    <div class="quarto-category">GIS</div>
    <div class="quarto-category">R</div>
  </div>
  </div>

<div>
  <div class="description">
    In this blog post, I would demonstrate how I used the osrm package in R to return the distance and travel time between a destination and different sources
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Olumide Oyalola </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 19, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="introduction-to-osrm-r-package" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-osrm-r-package">Introduction to OSRM R package</h2>
<p>An interface between <code>R</code> and the <code>OSRM</code> (OpenStreetMap-Based Routing Service) API. <code>OSRM</code> is a routing service based on <code>OpenStreetMap</code> data. <a href="http://project-osrm.org">See</a> for more information. This package allows to compute <strong>routes</strong>, <strong>trips</strong>, <strong>isochrones</strong> and <strong>travel distances</strong> matrices (<em>travel time in minutes</em> and <em>distance in kilometer</em>).</p>
<p>The package is available on CRAN and it can be installed by running the code chunk below from the Rstudio console.</p>
<p>For the purpose of this post, the <strong><em>osrmTable</em></strong> function from the <strong>osrm</strong> package in R would be used to return the distance in meter and the travel time in minutes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"osrm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-packages" class="level2">
<h2 class="anchored" data-anchor-id="load-packages">Load Packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install pacman package if needed</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: pacman</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the required packages</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  httr,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  jsonlite,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  tidyjson,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  tidyverse,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  lubridate,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  geosphere,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  anytime,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  tictoc,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  stringi,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  maptools,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  geosphere,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  sf,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  sp,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  openxlsx,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  leaflet,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  magrittr,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  janitor,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  arrow,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  magrittr,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  osrm</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="load-data" class="level3">
<h3 class="anchored" data-anchor-id="load-data">Load Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load parquet files as tibble</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>(<span class="st">"Load the parquet files"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"../../../../Dangote/IbeseLivePosition/data_parquet/"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">full.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">include.dirs =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>(., <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_df</span>(<span class="sc">~</span><span class="fu">read_parquet</span>(., <span class="at">as_tibble =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Load the parquet files: 19.4 sec elapsed</code></pre>
</div>
</div>
</section>
</section>
<section id="data-munging" class="level2">
<h2 class="anchored" data-anchor-id="data-munging">Data Munging</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>remove <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"/Date"</span>, <span class="st">"("</span>, <span class="st">")/"</span>, <span class="st">"[[:punct:]]"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>var <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ActualSpeed"</span>, <span class="st">"Address"</span>, <span class="st">"Altitude"</span>, <span class="st">"AssetClass"</span>, <span class="st">"AssetLocationID"</span>, <span class="st">"AssetStatus"</span>, <span class="st">"CategoryID"</span>, <span class="st">"CategoryName"</span>, <span class="st">"City"</span>, <span class="st">"CustomerName"</span>, <span class="st">"DateTimeLocal"</span>, <span class="st">"DateTimeReceived"</span>, <span class="st">"DeliveryOrderNumber"</span>, <span class="st">"DepartureDateTime"</span>, <span class="st">"DestinationArea"</span>, <span class="st">"DestinationCity"</span>, <span class="st">"DestinationSite"</span>, <span class="st">"DestinationStreet"</span>, <span class="st">"DeviceType"</span>, <span class="st">"DirectionString"</span>, <span class="st">"Distance"</span>, <span class="st">"DriverCode"</span>, <span class="st">"DriverID"</span>, <span class="st">"Geofence"</span>, <span class="st">"IgnitionStatus"</span>, <span class="st">"Information"</span>, <span class="st">"JourneyDistance"</span>, <span class="st">"JourneyDuration"</span>, <span class="st">"JourneyIdleTime"</span>, <span class="st">"JourneyMaxSpeed"</span>, <span class="st">"LastIgnitionOff"</span>, <span class="st">"LastIgnitionOn"</span>, <span class="st">"Latitude"</span>, <span class="st">"Load"</span>, <span class="st">"Longitude"</span>, <span class="st">"NumSatellites"</span>, <span class="st">"Odometer"</span>, <span class="st">"Reason"</span>, <span class="st">"ReasonString"</span>, <span class="st">"Reference"</span>, <span class="st">"Region"</span>, <span class="st">"SiteName"</span>, <span class="st">"SpeedOverGround"</span>, <span class="st">"Status"</span>, <span class="st">"Street"</span>, <span class="st">"TrackTrue"</span>, <span class="st">"TripDestination"</span>, <span class="st">"TripID"</span>, <span class="st">"TripSource"</span>, <span class="st">"TripType"</span>, <span class="st">"UTCDateTime"</span>, <span class="st">"WaybillNumber"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data cleaning</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#dplyr::select(tidyselect::all_of(var)) %&gt;% </span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DateTimeLocal =</span> <span class="fu">str_remove_all</span>(<span class="st">`</span><span class="at">DateTimeLocal</span><span class="st">`</span>, </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">paste</span>(remove, <span class="at">collapse =</span> <span class="st">"|"</span>)),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">DateTimeLocal =</span> <span class="fu">str_remove_all</span>(<span class="st">`</span><span class="at">DateTimeLocal</span><span class="st">`</span>, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"</span><span class="sc">\\</span><span class="st">+0100|</span><span class="sc">\\</span><span class="st">+0000"</span>),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">DateTimeLocal =</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">DateTimeLocal</span><span class="st">`</span>),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">DateTimeLocal =</span> <span class="st">`</span><span class="at">DateTimeLocal</span><span class="st">`</span><span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">DateTimeLocal =</span> <span class="fu">anytime</span>(<span class="st">`</span><span class="at">DateTimeLocal</span><span class="st">`</span>),</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">DateTimeReceived =</span> <span class="fu">str_remove_all</span>(DateTimeReceived, </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">paste</span>(remove, <span class="at">collapse =</span> <span class="st">"|"</span>)),</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">DateTimeReceived =</span> <span class="fu">str_remove_all</span>(DateTimeReceived, </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"</span><span class="sc">\\</span><span class="st">+0100|</span><span class="sc">\\</span><span class="st">+0000"</span>),</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">DateTimeReceived =</span> <span class="fu">as.numeric</span>(DateTimeReceived),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">DateTimeReceived =</span> DateTimeReceived<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">DateTimeReceived =</span> <span class="fu">anytime</span>(DateTimeReceived),</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">DepartureDateTime =</span> <span class="fu">str_remove_all</span>(DepartureDateTime, </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">paste</span>(remove, <span class="at">collapse =</span> <span class="st">"|"</span>)),</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">DepartureDateTime =</span> <span class="fu">str_remove_all</span>(DepartureDateTime, </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"</span><span class="sc">\\</span><span class="st">+0100|</span><span class="sc">\\</span><span class="st">+0000"</span>),</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">DepartureDateTime =</span> <span class="fu">as.numeric</span>(DepartureDateTime),</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">DepartureDateTime =</span> DepartureDateTime<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">DepartureDateTime =</span> <span class="fu">anytime</span>(DepartureDateTime),</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">UTCDateTime =</span> <span class="fu">str_remove_all</span>(UTCDateTime, </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">paste</span>(remove, <span class="at">collapse =</span> <span class="st">"|"</span>)),</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">UTCDateTime =</span> <span class="fu">str_remove_all</span>(UTCDateTime, </span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"</span><span class="sc">\\</span><span class="st">+0100|</span><span class="sc">\\</span><span class="st">+0000"</span>),</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">UTCDateTime =</span> <span class="fu">as.numeric</span>(UTCDateTime),</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">UTCDateTime =</span> UTCDateTime<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">UTCDateTime =</span> <span class="fu">anytime</span>(UTCDateTime),</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">LastIgnitionOff =</span> <span class="fu">str_remove_all</span>(LastIgnitionOff, </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">paste</span>(remove, <span class="at">collapse =</span> <span class="st">"|"</span>)),</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">LastIgnitionOff =</span> <span class="fu">str_remove_all</span>(LastIgnitionOff, </span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"</span><span class="sc">\\</span><span class="st">+0100|</span><span class="sc">\\</span><span class="st">+0000"</span>),</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">LastIgnitionOff =</span> <span class="fu">as.numeric</span>(LastIgnitionOff),</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">LastIgnitionOff =</span> LastIgnitionOff<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">LastIgnitionOff =</span> <span class="fu">anytime</span>(LastIgnitionOff),</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">LastIgnitionOn =</span> <span class="fu">str_remove_all</span>(LastIgnitionOn, </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">paste</span>(remove, <span class="at">collapse =</span> <span class="st">"|"</span>)),</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">LastIgnitionOn =</span> <span class="fu">str_remove_all</span>(LastIgnitionOn, </span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"</span><span class="sc">\\</span><span class="st">+0100|</span><span class="sc">\\</span><span class="st">+0000"</span>),</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">LastIgnitionOn =</span> <span class="fu">as.numeric</span>(LastIgnitionOn),</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">LastIgnitionOn =</span> LastIgnitionOn<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>         <span class="at">LastIgnitionOn =</span> <span class="fu">anytime</span>(LastIgnitionOn)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">between</span>(TripID, <span class="dv">9000000000</span>, <span class="cn">Inf</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>TripID <span class="sc">==</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: between() called on numeric vector with S3 class</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">TripID =</span> <span class="fu">as.numeric</span>(TripID))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># destination dataframe</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>ibese_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="st">"ibese"</span>, <span class="at">lon =</span> <span class="fu">c</span>(<span class="fl">3.043568</span>), <span class="at">lat =</span> <span class="fu">c</span>(<span class="fl">7.006293</span>))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>ibese <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">3.043568</span>,<span class="fl">7.006293</span>), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>ibese_geofence <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Ibese"</span>, <span class="st">"IBESE"</span>, <span class="st">"Vehicle Park"</span>, <span class="st">"Vehicle Park 2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="determining-the-direction-of-the-truck" class="level3">
<h3 class="anchored" data-anchor-id="determining-the-direction-of-the-truck">Determining the direction of the truck</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>inbound_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(AssetStatus <span class="sc">==</span> <span class="st">"InService"</span>, Longitude <span class="sc">&gt;</span> <span class="dv">0</span>, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>         Latitude <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">between</span>(TripID, <span class="dv">9000000000</span>, <span class="cn">Inf</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TripID <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Reference, DateTimeReceived, </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>         Longitude, Latitude, TripID, Geofence, Altitude) <span class="sc">%&gt;%</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Reference, DateTimeReceived) <span class="sc">%&gt;%</span> </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Reference, TripID) <span class="sc">%&gt;%</span> </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.after =</span> DateTimeReceived,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">TimeDiff =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(DateTimeReceived, </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">lag</span>(DateTimeReceived, </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">default =</span> <span class="fu">first</span>(DateTimeReceived)), </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">units =</span> <span class="st">"hours"</span>)),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">LongLat =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(Longitude, Latitude), <span class="at">ncol =</span> <span class="dv">2</span>),</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">DistCovered =</span> <span class="fu">distGeo</span>(LongLat, <span class="fu">lag</span>(LongLat)),</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">DistCovered =</span> DistCovered<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">DistToPlant =</span> <span class="fu">distGeo</span>(LongLat, ibese),</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">DistToPlant =</span> DistToPlant<span class="sc">/</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Direction =</span> <span class="fu">if_else</span>(<span class="fu">lag</span>(DistToPlant) <span class="sc">&lt;</span> DistToPlant, <span class="st">"Inbound"</span>, <span class="st">"Outbound"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Direction <span class="sc">==</span> <span class="st">"Inbound"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TripID <span class="sc">!=</span> <span class="dv">3000071349</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="estimating-the-arrival-time-and-distance" class="level3">
<h3 class="anchored" data-anchor-id="estimating-the-arrival-time-and-distance">Estimating the arrival time and distance</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>duration <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> inbound_df <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">filter</span>(<span class="fu">as.Date</span>(DateTimeReceived) <span class="sc">==</span> <span class="fu">today</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">select</span>(TripID, Longitude, Latitude) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">100</span>),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">dst =</span> ibese_df, <span class="at">measure =</span> <span class="st">"duration"</span>, <span class="at">osrm.profile =</span> <span class="st">"car"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>distance <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">src =</span> inbound_df <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">filter</span>(<span class="fu">as.Date</span>(DateTimeReceived) <span class="sc">==</span> <span class="fu">today</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">select</span>(TripID, Longitude, Latitude) <span class="sc">%&gt;%</span> </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">100</span>),</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">dst =</span> ibese_df, <span class="at">measure =</span> <span class="st">"distance"</span>, <span class="at">osrm.profile =</span> <span class="st">"car"</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>distances <span class="ot">&lt;-</span> distance<span class="sc">$</span>distances <span class="sc">%&gt;%</span> </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">TripID =</span> rowname,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">Distance =</span> ibese) <span class="sc">%&gt;%</span> </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TripID =</span> <span class="fu">as.numeric</span>(TripID))</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>durations <span class="ot">&lt;-</span> duration<span class="sc">$</span>durations <span class="sc">%&gt;%</span> </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">TripID =</span> rowname,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">duration =</span> ibese) <span class="sc">%&gt;%</span> </span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TripID =</span> <span class="fu">as.numeric</span>(TripID))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-join" class="level2">
<h2 class="anchored" data-anchor-id="data-join">Data Join</h2>
<p>Joining the <code>durations</code>, <code>distances</code> and <code>inbound_df</code> data frames.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>arrival <span class="ot">&lt;-</span> inbound_df <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(durations, <span class="at">by =</span> <span class="st">'TripID'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(distances, <span class="at">by =</span> <span class="st">'TripID'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Arrival =</span> DateTimeReceived <span class="sc">+</span> <span class="fu">minutes</span>(<span class="fu">round</span>(duration))) <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(TripID, Reference, Longitude, Latitude, Distance, DateTimeReceived, Arrival) <span class="sc">%&gt;%</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Distance)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(arrival)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="htmlwidget-0d01bd3e6a31383e4fe2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0d01bd3e6a31383e4fe2">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],[3000527098,3000526488,3100349168,3000518546,3100349304,3000527523,3000527382,3100349127,3100349383,3000527483,3000526814,3100349364,3100349388,3100349402,3000527552,3000527526,3000527344,3000527658,3000527491,3000527474,3000526789,3000527585,3000526895,3100348980,3000527136,3100349182,3100348952,3000527013,3000527398,3000527217,3100349268,3100349261,3000527435,3100348764,3100348899,3100348721,3100349006,3000527363,3100349247,3000527383,3000527108,3100349327,3000527380,3000525061,3000527439,3000527329,3000527081,3000527351,3000527567,3000527370,3000525962,3000527426,3100349260,3100348074,3000527558,3000527353,3000527196,3100348232,3000527234,3000526852,3000527306,3000527183,3000527210,3000526314,3000527218,3000527191,3000526970,3000526971,3000527121,3000526668,3000527209,3100348734,3100348730,3100348696,3100348610,3100348872,3100349039,3100348726,3100347980,3100348992,3000527113,3100348735,3100347443,3100348725,3000526829,3000527170,3100349328,3000526759,3000527222,3100349133,3100348862,3100349129,3100349131,3100348810,3100348767,3100349110,3000526483,3000526467,3000527083,3100348975],["AKM01XG","BCH548XA","BCH534XA","ABS81XA","BAS15XA","BCH193XA","AJA42XA","ABS73XA","AAB440YJ","BAS208XA","AJG39XA","ABS78XA","AAB442YJ","AKM02XG","BCH30XA","AJG35XA","BCH519XA","BNK459XA","BCH547XA","BCH522XA","ABS66XA","AJG29XA","AJK190XA","AJA35XA","BNK457XA","DAL453ZX","AJK195XA","AJG269XA","AJG48XA","AJG40XA","BCH538XA","AJG34XA","BNK462XA","BCH25XA","ABS67XA","BCH28XA","ABS76XA","ABS89XA","AJK149XA","AKM08XG","DAL495ZX","AKM05XG","AJG37XA","BNK452XA","AJG163XA","DAL539ZX","ABS94XA","AJK147XA","BCH510XA","ABS80XA","DAL579ZX","AAB340YJ","DAL589ZX","AJA505XA","DAL662ZY","AJA501XA","AJK301XA","DAL661ZY","DAL663ZY","BAS209XA","AJK178XA","BGW129XA","AJA510XA","BCH526XA","BAS210XA","DAL657ZY","BCH512XA","BGW127XA","BCH513XA","AJK189XA","AJK196XA","AJK194XA","BCH520XA","BCH542XA","BCH504XA","DAL658ZY","BCH527XA","AJA503XA","AJK302XA","AJK177XA","BCH535XA","BCH541XA","BAS207XA","BCH509XA","BCH505XA","BCH517XA","AJK146XA","BAS203XA","BCH511XA","AJA506XA","BCH539XA","BCH503XA","AJK305XA","BCH532XA","AJK179XA","BCH516XA","BCH525XA","BCH550XA","AJK188XA","DAL660ZY"],[3.0463101,3.0436641,3.0440553,3.0467681,3.0470831,3.0478346,3.0483115,3.0488503,3.042499,3.03585,3.0636011,3.0661148,3.0670116,3.0691676,3.1032418,3.1034121,3.192489,2.99423,3.2949633,3.222758,3.2980965,3.367463,3.1264526,3.2044343,3.3368441,3.3398425,3.531934,3.3724283,3.2437701,3.3683831,3.3465846,3.350945,3.3208341,3.343089,3.3783855,3.3547761,3.3545236,3.3349526,3.3349116,3.3806646,3.4192736,3.419048,3.5692378,3.3668625,3.3273588,3.6363485,3.5041295,3.6585978,3.4231061,3.57339,3.9056878,3.9665855,4.5436436,4.9066578,4.8214921,4.8371786,4.718565,5.3462888,4.760771,5.1115796,5.74619,5.0852821,5.1333348,5.7184866,5.2962311,5.7316548,5.7944206,5.7945578,5.7946348,5.794368,5.7964911,5.8406045,5.977985,6.6838326,6.6837201,6.0207661,6.0209336,6.0212538,6.3094453,6.0725963,6.0727038,6.438148,6.1982,5.9255133,6.319905,6.4351516,6.4590875,6.3630116,6.3203348,6.7007001,7.028687,7.029238,7.0296185,7.0293958,7.0312673,7.0309648,7.077253,7.0739993,7.0730891,7.0498743],[6.9978161,7.0148343,7.0152953,7.0126328,7.0122498,7.0120001,7.0124633,7.0124085,7.0211563,6.9685348,7.0132908,7.0134635,7.0135223,7.0135736,7.0083041,7.0080258,6.9517863,6.72172,7.1364983,6.936012,7.1198503,7.1224221,6.646654,6.6821746,6.604097,6.5853065,6.9573135,6.5788728,6.5522475,6.5727008,6.5374088,6.5280955,6.5592351,6.5308291,6.5854856,6.5589486,6.5593878,6.5277428,6.5285508,6.5393873,6.7369581,6.7370051,6.910022,6.4562848,6.4803905,6.8591396,6.5932818,6.962841,7.7553376,6.57972,7.4042186,7.336329,7.7956171,6.7512125,7.0956385,7.0834131,8.1376366,6.5604161,8.3203116,8.131717,6.31493,8.897738,8.1079695,6.263537,8.7833786,5.8539905,5.5645628,5.5648661,5.565105,5.5652075,5.5673616,5.501968,5.5187608,6.2041905,6.2038498,5.4686066,5.4666265,5.4623508,5.6275845,5.298284,5.2970491,5.725777,5.2234971,5.1661408,5.1224593,5.0692075,5.058153,4.9498811,4.8880063,5.0630003,4.9370525,4.9359815,4.9356918,4.9356696,4.9323528,4.932456,4.8451581,4.8484353,4.8489746,4.8839246],[1108,3198,3265,3332,3363,3444,3500,3560,3973,4610,5192,5470,5569,5808,9970,10006,23403,35413,37279,40749,40855,48213,48298,56568,75051,75174,77432,80149,80263,80864,81409,82681,83236,83336,84201,85050,85059,85073,85124,85583,87684,87716,89726,91142,95557,96420,99567,106918,107903,108415,123589,130303,221829,243146,261542,264689,267928,305120,307316,357641,358072,360540,361266,365171,385080,405906,440527,440541,440567,440732,440881,453203,461990,466442,466482,469452,470333,471595,489078,490585,492012,494777,512751,522702,532837,543789,547061,559158,571129,577050,652233,652367,652378,652405,652790,652800,673744,675877,676046,677734],["2023-01-25T11:57:40Z","2023-01-25T15:21:54Z","2023-01-25T15:30:19Z","2023-01-25T15:56:06Z","2023-01-25T15:01:55Z","2023-01-25T15:52:32Z","2023-01-25T15:58:06Z","2023-01-25T14:06:22Z","2023-01-25T15:57:44Z","2023-01-25T16:29:43Z","2023-01-25T14:24:01Z","2023-01-25T16:27:21Z","2023-01-25T12:36:18Z","2023-01-25T14:40:15Z","2023-01-25T15:55:23Z","2023-01-25T16:06:32Z","2023-01-25T16:28:21Z","2023-01-25T16:30:13Z","2023-01-25T16:30:14Z","2023-01-25T16:14:30Z","2023-01-25T16:29:21Z","2023-01-25T16:27:43Z","2023-01-25T16:16:06Z","2023-01-25T14:14:47Z","2023-01-25T16:06:50Z","2023-01-25T11:42:52Z","2023-01-25T11:32:20Z","2023-01-25T15:14:09Z","2023-01-25T15:14:14Z","2023-01-25T16:14:35Z","2023-01-25T11:43:04Z","2023-01-25T13:29:46Z","2023-01-25T09:13:48Z","2023-01-25T11:59:41Z","2023-01-25T15:14:41Z","2023-01-25T11:29:02Z","2023-01-25T15:41:46Z","2023-01-25T14:21:28Z","2023-01-25T09:53:59Z","2023-01-25T13:44:16Z","2023-01-25T12:58:07Z","2023-01-25T16:03:58Z","2023-01-25T16:13:52Z","2023-01-25T14:58:21Z","2023-01-25T10:34:01Z","2023-01-25T05:55:44Z","2023-01-25T14:21:55Z","2023-01-25T15:39:21Z","2023-01-25T15:55:45Z","2023-01-25T13:31:15Z","2023-01-25T12:09:51Z","2023-01-25T12:25:15Z","2023-01-25T09:57:09Z","2023-01-25T16:00:07Z","2023-01-25T16:09:33Z","2023-01-25T15:44:10Z","2023-01-25T15:12:06Z","2023-01-25T13:25:04Z","2023-01-25T14:29:39Z","2023-01-25T14:24:43Z","2023-01-25T13:45:03Z","2023-01-25T16:24:11Z","2023-01-25T16:29:49Z","2023-01-25T16:14:44Z","2023-01-25T06:39:57Z","2023-01-25T16:01:30Z","2023-01-25T14:48:36Z","2023-01-25T16:25:01Z","2023-01-25T16:22:33Z","2023-01-25T13:57:47Z","2023-01-25T14:59:07Z","2023-01-25T14:38:51Z","2023-01-25T15:39:23Z","2023-01-25T13:17:31Z","2023-01-25T10:59:09Z","2023-01-25T15:42:33Z","2023-01-25T14:17:31Z","2023-01-25T16:13:27Z","2023-01-25T13:29:38Z","2023-01-25T08:24:19Z","2023-01-25T15:51:35Z","2023-01-25T15:49:25Z","2023-01-25T15:31:18Z","2023-01-25T16:09:21Z","2023-01-25T14:29:49Z","2023-01-25T16:12:43Z","2023-01-25T16:29:00Z","2023-01-25T15:59:50Z","2023-01-25T07:28:48Z","2023-01-25T16:29:35Z","2023-01-25T16:04:51Z","2023-01-25T15:55:30Z","2023-01-25T14:49:01Z","2023-01-25T16:12:05Z","2023-01-25T15:56:06Z","2023-01-25T09:36:21Z","2023-01-25T15:57:57Z","2023-01-25T16:29:36Z","2023-01-25T15:00:22Z","2023-01-25T14:50:36Z"],["2023-01-25T12:01:40Z","2023-01-25T15:27:54Z","2023-01-25T15:36:19Z","2023-01-25T16:03:06Z","2023-01-25T15:08:55Z","2023-01-25T15:59:32Z","2023-01-25T16:05:06Z","2023-01-25T14:13:22Z","2023-01-25T16:04:44Z","2023-01-25T16:37:43Z","2023-01-25T14:34:01Z","2023-01-25T16:37:21Z","2023-01-25T12:46:18Z","2023-01-25T14:50:15Z","2023-01-25T16:12:23Z","2023-01-25T16:23:32Z","2023-01-25T17:05:21Z","2023-01-25T17:06:13Z","2023-01-25T17:09:14Z","2023-01-25T16:58:30Z","2023-01-25T17:11:21Z","2023-01-25T17:15:43Z","2023-01-25T17:12:06Z","2023-01-25T15:11:47Z","2023-01-25T17:16:50Z","2023-01-25T12:49:52Z","2023-01-25T12:40:20Z","2023-01-25T16:27:09Z","2023-01-25T16:29:14Z","2023-01-25T17:28:35Z","2023-01-25T12:56:04Z","2023-01-25T14:43:46Z","2023-01-25T10:28:48Z","2023-01-25T13:12:41Z","2023-01-25T16:31:41Z","2023-01-25T12:45:02Z","2023-01-25T16:57:46Z","2023-01-25T15:38:28Z","2023-01-25T11:09:59Z","2023-01-25T15:01:16Z","2023-01-25T14:18:07Z","2023-01-25T17:24:58Z","2023-01-25T17:30:52Z","2023-01-25T16:18:21Z","2023-01-25T11:55:01Z","2023-01-25T07:19:44Z","2023-01-25T15:49:55Z","2023-01-25T17:08:21Z","2023-01-25T17:38:45Z","2023-01-25T15:11:15Z","2023-01-25T13:51:51Z","2023-01-25T14:17:15Z","2023-01-25T12:58:09Z","2023-01-25T19:05:07Z","2023-01-25T19:43:33Z","2023-01-25T19:22:10Z","2023-01-25T18:56:06Z","2023-01-25T17:16:04Z","2023-01-25T18:21:39Z","2023-01-25T18:52:43Z","2023-01-25T18:12:03Z","2023-01-25T21:14:11Z","2023-01-25T20:59:49Z","2023-01-25T20:46:44Z","2023-01-25T11:35:57Z","2023-01-25T21:04:30Z","2023-01-25T20:18:36Z","2023-01-25T21:55:01Z","2023-01-25T21:52:33Z","2023-01-25T19:28:47Z","2023-01-25T20:30:07Z","2023-01-25T20:23:51Z","2023-01-25T21:30:23Z","2023-01-25T19:01:31Z","2023-01-25T16:43:09Z","2023-01-25T21:39:33Z","2023-01-25T20:15:31Z","2023-01-25T22:13:27Z","2023-01-25T19:54:38Z","2023-01-25T14:41:19Z","2023-01-25T22:09:35Z","2023-01-25T22:26:25Z","2023-01-25T22:09:18Z","2023-01-25T23:03:21Z","2023-01-25T21:25:49Z","2023-01-25T23:18:43Z","2023-01-25T23:38:00Z","2023-01-25T23:21:50Z","2023-01-25T15:00:48Z","2023-01-26T00:06:35Z","2023-01-26T00:19:51Z","2023-01-26T00:10:30Z","2023-01-25T23:04:01Z","2023-01-26T00:27:05Z","2023-01-26T00:12:06Z","2023-01-25T17:52:21Z","2023-01-26T00:12:57Z","2023-01-26T00:46:36Z","2023-01-25T23:17:22Z","2023-01-25T23:09:36Z"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>TripID<\/th>\n      <th>Reference<\/th>\n      <th>Longitude<\/th>\n      <th>Latitude<\/th>\n      <th>Distance<\/th>\n      <th>DateTimeReceived<\/th>\n      <th>Arrival<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>



</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>